@model Company
@{
    ViewData["Title"] = "Company Dashboard";
    // Cast ViewBag data to strongly typed variables
    var totalJobs = ViewBag.TotalJobs as int? ?? 0;
    var activeJobs = ViewBag.ActiveJobs as int? ?? 0;
    var totalApplications = ViewBag.TotalApplications as int? ?? 0;
    var recentApplications = ViewBag.RecentApplications as List<JobApplication> ?? new List<JobApplication>();
}

<div class="container mt-4">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient text-white">
                <div class="card-body">
                    <h2 class="card-title"><i class="fas fa-building"></i> Welcome, @Model.CompanyName!</h2>
                    <p class="card-text">Manage your job postings and track applications from talented professionals.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <!-- Company Info Card -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5><i class="fas fa-building"></i> Company Profile</h5>
                </div>
                <div class="card-body">
                    <p><strong>Industry:</strong> @Model.Industry</p>
                    <p>
                        <strong>Website:</strong>
                        @if (!string.IsNullOrEmpty(Model.Website))
                        {
                            <a href="@(Model.Website.StartsWith("http") ? Model.Website : "https://" + Model.Website)"
                               target="_blank">@Model.Website</a>
                        }
                        else
                        {
                            <span class="text-muted">Not provided</span>
                        }
                    </p>
                    <p>
                        <strong>Location:</strong>
                        @(!string.IsNullOrEmpty(Model.Address) ? Model.Address : "Not provided")
                    </p>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-info text-white">
                    <h6><i class="fas fa-chart-bar"></i> Quick Stats</h6>
                </div>
                <div class="card-body text-center">
                    <div class="mb-3">
                        <h3 class="text-primary">@totalJobs</h3>
                        <small>Total Jobs</small>
                    </div>
                    <div class="mb-3">
                        <h3 class="text-success">@activeJobs</h3>
                        <small>Active Jobs</small>
                    </div>
                    <div>
                        <h3 class="text-warning">@totalApplications</h3>
                        <small>Total Applications</small>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h6><i class="fas fa-bolt"></i> Quick Actions</h6>
                </div>
                <div class="card-body">
                    <a href="@Url.Action("Create", "JobPostingMvc")" class="btn btn-primary btn-sm w-100 mb-2">
                        <i class="fas fa-plus"></i> Post New Job
                    </a>
                    <a href="@Url.Action("MyPostings", "JobPostingMvc")" class="btn btn-secondary btn-sm w-100 mb-2">
                        <i class="fas fa-briefcase"></i> Manage Jobs
                    </a>
                    <a href="@Url.Action("Profile", "Account", new { userId = Model.UserId })"
                       class="btn btn-outline-primary btn-sm w-100">
                        <i class="fas fa-user"></i> Edit Profile
                    </a>
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <!-- Recent Applications -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5><i class="fas fa-users"></i> Recent Applications</h5>
                </div>
                <div class="card-body">
                    @if (recentApplications.Count > 0)
                    {
                        foreach (var application in recentApplications.Take(5))
                        {
                            <div class="d-flex justify-content-between align-items-center mb-3 p-3 border rounded">
                                <div>
                                    <strong>@application.JobPosting?.Title</strong><br>
                                    <small class="text-muted">
                                        Applied: @application.AppliedDate.ToString("MMM dd, yyyy") |
                                        Status: <span class="badge bg-info">@application.Status</span>
                                    </small>
                                </div>
                                <span class="badge bg-success">New</span>
                            </div>
                        }

                        @if (recentApplications.Count > 5)
                        {
                            <div class="text-center mt-3">
                                <a href="#" class="btn btn-sm btn-outline-primary">View All Applications</a>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted">No recent applications. Applications will appear here when candidates apply to your jobs.</p>
                    }
                </div>
            </div>

            <!-- Active Job Postings -->
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5><i class="fas fa-briefcase"></i> Your Active Job Postings</h5>
                </div>
                <div class="card-body">
                    @if (Model.JobPostings != null && Model.JobPostings.Any(j => j.IsActive && j.DeadlineDate > DateTime.Now))
                    {
                        foreach (var job in Model.JobPostings.Where(j => j.IsActive && j.DeadlineDate > DateTime.Now).Take(3))
                        {
                            <div class="card mb-3 job-card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title">@job.Title</h6>
                                        <span class="badge bg-primary">@job.JobType</span>
                                    </div>
                                    <p class="card-text text-muted mb-2">
                                        @(job.Description.Length > 100 ? job.Description.Substring(0, 100) + "..." : job.Description)
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            <i class="fas fa-users"></i> @job.JobApplications.Count applications |
                                            <i class="fas fa-clock"></i> @job.DeadlineDate?.ToString("MMM dd, yyyy")
                                        </small>
                                        <a href="@Url.Action("Details", "JobPosting", new { id = job.Id })"
                                           class="btn btn-sm btn-outline-primary">View Details</a>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.JobPostings.Count(j => j.IsActive && j.DeadlineDate > DateTime.Now) > 3)
                        {
                            <div class="text-center mt-3">
                                <a href="@Url.Action("MyPostings", "JobPostingMvc")" class="btn btn-sm btn-outline-primary">View All Jobs</a>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted">
                            No active job postings.
                            <a href="@Url.Action("Create", "JobPostingMvc")" class="text-primary">Post your first job!</a>
                        </p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .bg-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .job-card {
        transition: transform 0.2s ease-in-out;
        border: none;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

    .card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .card-header {
        border-radius: 10px 10px 0 0 !important;
        font-weight: 600;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 6px;
    }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

    .badge {
        font-size: 0.75rem;
        padding: 0.35em 0.65em;
    }
</style>