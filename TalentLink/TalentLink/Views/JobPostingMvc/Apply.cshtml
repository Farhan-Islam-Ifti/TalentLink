@model TalentLink.Models.ApplyJobViewModel
@{
    var jobPosting = ViewBag.JobPosting as JobPosting;
    var jobSeeker = ViewBag.JobSeeker as JobSeeker;
    ViewData["Title"] = $"Apply for {jobPosting?.Title}";
}

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-9">
            <div class="apply-card shadow-lg animate__animated animate__fadeInUp">
                <div class="apply-card-header text-white">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-paper-plane me-2"></i> Apply for Position
                    </h3>
                </div>
                <div class="apply-card-body">
                    <div class="alert custom-alert animate__animated animate__fadeInDown">
                        <i class="fas fa-info-circle me-2"></i>
                        You are applying for:
                        <strong>@jobPosting?.Title</strong> at <strong>@jobPosting?.Company.CompanyName</strong>
                    </div>

                    <form asp-action="Apply" method="post" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="jobPostingId" value="@jobPosting?.Id" />

                        <!-- Candidate Info -->
                        <div class="mb-4">
                            <label class="form-label fw-bold">Your Information</label>
                            <div class="info-box">
                                <p class="mb-1"><strong>Name:</strong> @jobSeeker?.User.FirstName @jobSeeker?.User.LastName</p>
                                <p class="mb-1"><strong>Email:</strong> @jobSeeker?.User.Email</p>
                                @if (!string.IsNullOrEmpty(jobSeeker?.CVFilePath))
                                {
                                    <p class="mb-0">
                                        <strong>Current CV:</strong>
                                        <a href="@jobSeeker.CVFilePath" target="_blank" class="link-custom">
                                            <i class="fas fa-file-alt me-1"></i> View Current CV
                                        </a>
                                    </p>
                                }
                                else
                                {
                                    <p class="mb-0 text-warning">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        No CV uploaded yet
                                    </p>
                                }
                            </div>
                        </div>

                        <!-- Cover Letter -->
                        <div class="mb-4">
                            <label asp-for="CoverLetter" class="form-label fw-bold">Cover Letter *</label>
                            <textarea asp-for="CoverLetter" class="form-control custom-input" rows="6"
                                      placeholder="Why are you interested in this position? What makes you a strong candidate?"></textarea>
                            <span asp-validation-for="CoverLetter" class="text-danger"></span>
                        </div>

                        <!-- CV Upload -->
                        <div class="mb-4">
                            <label asp-for="CVFile" class="form-label fw-bold">Upload CV (optional)</label>
                            <input asp-for="CVFile" type="file" id="CVFile" class="form-control custom-input" accept=".pdf,.doc,.docx">
                            <small class="form-text text-muted">Accepted formats: PDF, DOC, DOCX | Max size: 5MB</small>
                            <span asp-validation-for="CVFile" class="text-danger"></span>
                        </div>

                        <!-- Save CV -->
                        <div class="mb-4 form-check">
                            <input asp-for="SaveCV" class="form-check-input" />
                            <label asp-for="SaveCV" class="form-check-label">Save this CV as my default</label>
                            <small class="form-text text-muted d-block">This CV will be used for future applications</small>
                        </div>

                        <!-- Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="@Url.Action("Details", "JobApplicationMvc", new { id = jobPosting?.Id })"
                               class="btn btn-outline-secondary btn-animated me-md-2">
                                <i class="fas fa-arrow-left me-1"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-gradient btn-animated">
                                <i class="fas fa-paper-plane me-1"></i> Submit Application
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // File size validation
        document.querySelector('form').addEventListener('submit', function (e) {
            const fileInput = document.getElementById('CVFile');
            if (fileInput && fileInput.files[0]) {
                const fileSize = fileInput.files[0].size;
                const maxSize = 5 * 1024 * 1024; // 5MB
                if (fileSize > maxSize) {
                    e.preventDefault();
                    alert('File size must be less than 5MB');
                }
            }
        });
    </script>
}

<style>
    /* Card */
    .apply-card {
        border-radius: 16px;
        background: #fff;
        overflow: hidden;
    }

    .apply-card-header {
        background: linear-gradient(135deg, #6a11cb, #2575fc);
        padding: 20px;
        font-weight: 600;
        font-size: 1.3rem;
        border-bottom: none;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }

    .apply-card-body {
        padding: 30px;
        background: #fafafa;
    }

    /* Info box */
    .info-box {
        background: linear-gradient(135deg, rgba(106,17,203,0.1), rgba(37,117,252,0.1));
        border-left: 4px solid #6a11cb;
        padding: 15px;
        border-radius: 10px;
    }

    /* Buttons */
    .btn-gradient {
        background: linear-gradient(135deg, #42ba96, #3b8d99);
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 600;
        transition: all 0.3s ease;
        color: #fff;
    }

        .btn-gradient:hover {
            background: linear-gradient(135deg, #3aa986, #357f8a);
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.2);
        }

    .btn-animated {
        position: relative;
        overflow: hidden;
    }

        .btn-animated::after {
            content: "";
            position: absolute;
            width: 0;
            height: 100%;
            top: 0;
            left: 0;
            background: rgba(255,255,255,0.2);
            transition: width 0.4s ease;
        }

        .btn-animated:hover::after {
            width: 100%;
        }

    /* Inputs */
    .custom-input {
        border-radius: 8px;
        border: 1px solid #ddd;
        transition: 0.3s;
    }

        .custom-input:focus {
            border-color: #6a11cb;
            box-shadow: 0 0 8px rgba(106, 17, 203, 0.3);
        }

    /* Alert */
    .custom-alert {
        border-radius: 10px;
        background: linear-gradient(135deg, rgba(66,186,150,0.15), rgba(59,141,153,0.15));
        border: none;
        color: #333;
        padding: 15px;
        font-weight: 500;
    }

    /* Link */
    .link-custom {
        color: #2575fc;
        font-weight: 600;
        text-decoration: none;
    }

        .link-custom:hover {
            text-decoration: underline;
        }

    /* Animate.css fadeInUp & fadeInDown keyframes */
    .animate__animated {
        animation-duration: 0.8s;
        animation-fill-mode: both;
    }

    .animate__fadeInUp {
        animation-name: fadeInUp;
    }

    .animate__fadeInDown {
        animation-name: fadeInDown;
    }

    @@keyframes fadeInUp {
        0%

    {
        opacity: 0;
        transform: translateY(20px);
    }

    100% {
        opacity: 1;
        transform: translateY(0);
    }

    }

    @@keyframes fadeInDown {
        0%

    {
        opacity: 0;
        transform: translateY(-20px);
    }

    100% {
        opacity: 1;
        transform: translateY(0);
    }

    }
</style>
