@using TalentLink.Models
@inject TalentLink.Services.IAuthService AuthService
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject Microsoft.AspNetCore.Identity.UserManager<ApplicationUser> UserManager

@{
    var userId = HttpContextAccessor.HttpContext.Session.GetString("UserId");
    var firstName = HttpContextAccessor.HttpContext.Session.GetString("FirstName");

    ApplicationUser user = null;
    if (!string.IsNullOrEmpty(userId))
    {
        user = await UserManager.FindByIdAsync(userId);
    }

    string role = user?.Role.ToString() ?? "";
}

@if (user != null)
{
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h4 class="mb-0">Welcome, @firstName</h4>
            <button class="btn-close btn-close-white" id="closeSidebar"></button>
        </div>

        <div class="sidebar-content d-flex flex-column justify-content-between h-100">
            <!-- Top: Links -->
            <div class="mt-4">
                <ul class="list-unstyled sidebar-links">
                    @if (role == "Admin")
                    {
                        <li><a class="sidebar-link" asp-controller="Admin" asp-action="Dashboard"><i class="fas fa-chart-line me-2"></i> Dashboard</a></li>
                        <li><a class="sidebar-link" asp-controller="Admin" asp-action="Users"><i class="fas fa-users me-2"></i> Manage Users</a></li>
                    }
                    else if (role == "Company")
                    {
                        <li>
                            <a class="sidebar-link"
                               asp-controller="Company"
                               asp-action="Profile"
                               asp-route-userId="@Context.Session.GetString("UserId")">
                                <i class="fas fa-user me-2"></i> My Profile
                            </a>
                        </li>
                        <li>
                            <a class="sidebar-link"
                               asp-controller="Company"
                               asp-action="EditProfile"
                               asp-route-userId="@Context.Session.GetString("UserId")">
                                <i class="fas fa-edit me-2"></i> Edit Profile
                            </a>
                        </li>
                        <li><a class="sidebar-link" asp-controller="Company" asp-action="Dashboard"><i class="fas fa-building me-2"></i> Dashboard</a></li>
                        <li><a class="sidebar-link" asp-controller="Company" asp-action="PostJob"><i class="fas fa-plus me-2"></i> Post Job</a></li>
                        <li><a class="sidebar-link" asp-controller="Company" asp-action="MyJobs"><i class="fas fa-briefcase me-2"></i> My Jobs</a></li>
                    }
                    else if (role == "JobSeeker")
                    {
                        <li>
                            <a class="sidebar-link"
                               asp-controller="JobSeeker"
                               asp-action="Profile"
                               asp-route-userId="@Context.Session.GetString("UserId")">
                                <i class="fas fa-user me-2"></i> My Profile
                            </a>
                        </li>
                        <li>
                            <a class="sidebar-link"
                               asp-controller="JobSeeker"
                               asp-action="EditProfile"
                               asp-route-userId="@Context.Session.GetString("UserId")">
                                <i class="fas fa-user me-2"></i> Edit Profile
                            </a>
                        </li>
                        <li><a class="sidebar-link" asp-controller="JobSeeker" asp-action="Dashboard"><i class="fas fa-home me-2"></i> Dashboard</a></li>
                        <li><a class="sidebar-link" asp-controller="JobSeeker" asp-action="Jobs"><i class="fas fa-search me-2"></i> Available Jobs</a></li>
                        <li><a class="sidebar-link" asp-controller="JobSeeker" asp-action="Applications"><i class="fas fa-file-alt me-2"></i> My Applications</a></li>
                    }
                </ul>
            </div>

            <!-- Bottom: Logout -->
            <div class="text-center mb-3">
                <a href="#" id="logoutBtn" class="btn btn-outline-danger w-75">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </a>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <script>
        document.getElementById("logoutBtn")?.addEventListener("click", function(e){
            e.preventDefault();
            localStorage.removeItem("UserId");
            localStorage.removeItem("FirstName");
            window.location.href = '@Url.Action("Logout", "Account")';
        });
    </script>
}



